cpu "8085.tbl"
hof "int8"

org 9000h

CURDT: EQU 8FF1H
UPDDT: EQU 044cH
CURAD: EQU 8FEFH
UPDAD: EQU 0440H
OUTPUT:EQU 0389H

LXI H,0FFFFH
SHLD 8900H

TIMER:
	LXI H, 0000H
	MVI A, 99H 
	SHLD CURAD
	STA CURDT

NXT_SEC:
	LHLD CURAD
	LDA CURDT
	INR A
	DAA
	MVI B,60H
	CMP B
	JNZ ONE
		MVI A, 00H
		STA CURDT
		MOV A, L
		INR A
		DAA
		MOV L, A
		MVI B,60H
		CMP B
		JNZ TWO
			MVI L, 00H
			MOV A, H
			INR A
			DAA
			MOV H, A
			MVI B,12H
			CMP B
			JZ TIMER
			JMP TWO

	ONE:
	STA CURDT
	TWO:
	SHLD CURAD
	LDA 8840H
	JZ THREE
	MOV C,A
	LXI D,8840H
	FOUR:

	INX D
	XCHG
	MOV B,M
	XCHG
	LDA CURDT
	CMP B
	JZ LOL1
	INX D
	INX D
	JMP FIVE

	LOL1:
	INX D
	XCHG
	MOV B,M
	XCHG
	LHLD CURAD
	MOV A,L
	CMP B
	JZ LOL2
	INX D
	JMP FIVE

	LOL2:
	INX D
	XCHG
	MOV B,M
	XCHG
	LHLD CURAD
	MOV A,H
	CMP B
	JNZ FIVE

	LDA CURDT
	STA 8900H
	LHLD CURAD
	SHLD 8901H
	MVI A,0FFH
	LXI H,0FFFFH
	STA CURDT
	SHLD CURAD
	CALL UPDDT
	CALL UPDAD
	CALL DELAY
	LDA 8900H
	LHLD 8901H

	STA CURDT
	SHLD CURAD
	; RST 5

	JMP THREE
	FIVE:
	DCR C
	JNZ FOUR

	
	; JMP TIMER
	THREE: 
	CALL UPDDT
	CALL UPDAD
	CALL DELAY
	JMP NXT_SEC


JMP OVER

DELAY:
	LXI H, 540FH
	LXI D, 0004H
	LOOP1:
		LOOP2:
			LOOP3:
				DCR L
				JNZ LOOP3
			DCR H
			JNZ LOOP2
		DCR E
		JNZ LOOP1
	RET

OVER: 
RST 5